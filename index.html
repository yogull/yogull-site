<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yogull Community Platform</title>
    <base href="/">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <style>
        /* [Your existing CSS remains exactly the same] */
    </style>
</head>
<body>
    <!-- [All your existing HTML remains exactly the same until the script tag] -->

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAxHlbxOi8qJg8LjrglHZgxZ7qliqg-njI",
            authDomain: "gohealme-9bdf0.firebaseapp.com",
            projectId: "gohealme-9bdf0",
            storageBucket: "gohealme-9bdf0.appspot.com",
            messagingSenderId: "823297665017",
            appId: "1:823297665017:web:3427ba4397e12447ccbf28"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Fixed Auth State Handler
        auth.onAuthStateChanged((user) => {
            const path = window.location.pathname;
            if (user && !path.includes('dashboard.html')) {
                window.location.href = '/dashboard.html';
            } else if (!user && path !== '/' && !path.includes('index.html')) {
                window.location.href = '/';
            }
        });

        // Email/Password Auth
        async function signInWithEmail() {
            const button = document.querySelector('.login-btn');
            const originalHtml = button.innerHTML;
            try {
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing In...';
                button.disabled = true;
                await auth.signInWithEmailAndPassword(
                    document.getElementById('email').value,
                    document.getElementById('password').value
                );
            } catch (error) {
                alert(`Login failed: ${error.message}`);
                console.error(error);
            } finally {
                button.innerHTML = originalHtml;
                button.disabled = false;
            }
        }

        // Social Auth Handlers (Google example - apply same pattern to others)
        async function signInWithGoogle() {
            const button = document.querySelector('.google-btn');
            const originalHtml = button.innerHTML;
            try {
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                button.disabled = true;
                await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
            } catch (error) {
                alert(`Google sign-in failed: ${error.message}`);
                console.error(error);
            } finally {
                button.innerHTML = originalHtml;
                button.disabled = false;
            }
        }

        // [Keep your existing affiliate and other functions]

        // Error Handling
        window.addEventListener('error', (e) => {
            console.log('Error:', e.message);
            return true;
        });
        window.addEventListener('unhandledrejection', (e) => {
            console.log('Promise error:', e.reason);
        });
    </script>
</body>
</html>
