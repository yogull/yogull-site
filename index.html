// ==============================================
// YOGULL PLATFORM - QA TEST SCRIPT
// ==============================================
// Usage: 
// 1. Open browser console (F12 > Console)
// 2. Paste and run this entire script
// 3. Follow the on-screen instructions

class YogullTester {
  constructor() {
    this.testResults = [];
    this.currentUser = null;
    this.delay = 1500; // ms between actions
  }

  async startTest() {
    console.log('%c=== YOGULL QA TEST STARTED ===', 'color: #4CAF50; font-size: 16px;');
    
    await this.testAuthenticationFlow();
    await this.testHealthTracking();
    await this.testCommunityFeatures();
    await this.testEcommerceFlow();
    await this.testAdminFunctions();
    
    this.generateReport();
  }

  async simulateClick(selector, actionName) {
    return new Promise(resolve => {
      const element = document.querySelector(selector);
      if (!element) {
        this.recordResult(false, actionName, `Element not found: ${selector}`);
        return resolve();
      }
      
      element.scrollIntoView({ behavior: 'smooth', block: 'center' });
      element.style.boxShadow = '0 0 0 3px rgba(0,255,0,0.5)';
      
      setTimeout(() => {
        element.click();
        this.recordResult(true, actionName);
        element.style.boxShadow = '';
        resolve();
      }, this.delay);
    });
  }

  async simulateInput(selector, value, actionName) {
    const element = document.querySelector(selector);
    if (!element) {
      this.recordResult(false, actionName, `Input not found: ${selector}`);
      return;
    }
    
    element.focus();
    element.value = value;
    element.dispatchEvent(new Event('input', { bubbles: true }));
    this.recordResult(true, actionName);
    await new Promise(resolve => setTimeout(resolve, this.delay));
  }

  recordResult(passed, action, notes = '') {
    const result = {
      passed,
      action,
      notes,
      timestamp: new Date().toISOString()
    };
    this.testResults.push(result);
    console.log(`%c${passed ? '✓' : '✗'} ${action}`, 
      `color: ${passed ? 'green' : 'red'};`);
    if (notes) console.log(`  → ${notes}`);
  }

  // ================= TEST CASES =================

  async testAuthenticationFlow() {
    console.group('%cAUTHENTICATION TESTS', 'color: #2196F3;');
    
    // Test 1: Email Signup
    await this.simulateClick('[onclick="signUpWithEmail()"]', 'Navigate to Signup');
    await this.simulateInput('#authEmail', `testuser_${Date.now()}@yogull.com`, 'Enter test email');
    await this.simulateInput('#authPassword', 'Test123!', 'Enter test password');
    await this.simulateClick('[onclick="signUpWithEmail()"]', 'Submit signup');
    
    // Test 2: Supplement Addition
    await this.simulateClick('#supplementsBtn', 'Navigate to Supplements');
    await this.simulateInput('#supplementName', 'Vitamin D3', 'Enter supplement name');
    await this.simulateInput('#supplementDosage', '2000 IU', 'Enter dosage');
    await this.simulateClick('[type="submit"]', 'Add supplement');
    
    // Test 3: Logout
    await this.simulateClick('[onclick="signOut()"]', 'Logout user');
    
    console.groupEnd();
  }

  async testHealthTracking() {
    console.group('%cHEALTH TRACKING TESTS', 'color: #4CAF50;');
    
    // Test 1: Biometric Entry
    await this.simulateClick('#biometricsBtn', 'Navigate to Biometrics');
    await this.simulateInput('#biometricSteps', '7500', 'Enter step count');
    await this.simulateInput('#biometricSleep', '7.5', 'Enter sleep hours');
    await this.simulateClick('[type="submit"]', 'Submit biometrics');
    
    // Test 2: Chart Verification
    const chart = document.querySelector('#biometricChart');
    if (chart) {
      this.recordResult(true, 'Chart rendered', 'Biometric chart visible');
    } else {
      this.recordResult(false, 'Chart rendered', 'No chart element found');
    }
    
    console.groupEnd();
  }

  async testCommunityFeatures() {
    console.group('%cCOMMUNITY TESTS', 'color: #FF9800;');
    
    // Test 1: Create Post
    await this.simulateClick('#profileWallBtn', 'Navigate to Profile Wall');
    await this.simulateInput('#profilePostContent', 'QA test post - please ignore', 'Enter post content');
    await this.simulateClick('[type="submit"]', 'Submit post');
    
    // Test 2: Discussion Creation
    await this.simulateClick('#communityBtn', 'Navigate to Community');
    await this.simulateInput('#discussionTitle', 'QA Test Discussion', 'Enter title');
    await this.simulateInput('#discussionContent', 'This is an automated test', 'Enter content');
    await this.simulateClick('[type="submit"]', 'Submit discussion');
    
    console.groupEnd();
  }

  async testEcommerceFlow() {
    console.group('%cECOMMERCE TESTS', 'color: #9C27B0;');
    
    // Test 1: Add to Cart
    await this.simulateClick('#shopBtn', 'Navigate to Shop');
    await this.simulateClick('[onclick*="addToCart(1)"]', 'Add Vitamin D3 to cart');
    
    // Test 2: Personal Shop Creation
    await this.simulateClick('#personalShopBtn', 'Navigate to Personal Shops');
    await this.simulateInput('#shopName', 'QA Test Shop', 'Enter shop name');
    await this.simulateInput('#shopDescription', 'Temporary shop for QA testing', 'Enter description');
    await this.simulateClick('[type="submit"]', 'Create shop');
    
    console.groupEnd();
  }

  async testAdminFunctions() {
    console.group('%cADMIN TESTS', 'color: #F44336;');
    
    // Test 1: Admin Access
    await this.simulateClick('#adminBtn', 'Navigate to Admin Panel');
    const adminElements = document.querySelectorAll('.admin-panel');
    this.recordResult(
      adminElements.length > 0,
      'Admin panel access',
      adminElements.length ? 'Admin elements found' : 'No admin elements detected'
    );
    
    console.groupEnd();
  }

  generateReport() {
    console.group('%c=== TEST REPORT ===', 'color: #3F51B5; font-size: 16px;');
    
    const passed = this.testResults.filter(t => t.passed).length;
    const failed = this.testResults.filter(t => !t.passed).length;
    
    console.log(`%cTOTAL: ${this.testResults.length} | %cPASS: ${passed} | %cFAIL: ${failed}`, 
      'font-weight: bold',
      `color: green; font-weight: bold`,
      `color: ${failed ? 'red' : 'green'}; font-weight: bold`);
    
    // Display failed tests first
    this.testResults
      .sort((a, b) => a.passed - b.passed)
      .forEach(test => {
        console.log(
          `%c${test.passed ? '✓' : '✗'} ${test.action}`,
          `color: ${test.passed ? 'green' : 'red'};`
        );
        if (test.notes) console.log(`  → ${test.notes}`);
      });
    
    console.groupEnd();
    
    // Highlight critical failures
    if (failed > 0) {
      console.log('%cCRITICAL ISSUES NEED ATTENTION', 
        'color: red; font-size: 14px; font-weight: bold;');
    } else {
      console.log('%cALL TESTS PASSED SUCCESSFULLY', 
        'color: green; font-size: 14px; font-weight: bold;');
    }
  }
}

// ======================
// RUN THE TEST SUITE
// ======================
const tester = new YogullTester();

// First ensure we're logged out
if (typeof signOut === 'function') {
  signOut();
}

setTimeout(() => {
  tester.startTest();
}, 2000);
